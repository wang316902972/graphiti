services:
  graphiti-mcp:
    image: zepai/knowledge-graph-mcp:standalone
    # For specific versions, replace 'standalone' with a version tag:
    #   image: zepai/knowledge-graph-mcp:1.0.0-standalone
    # When building locally, the build section below will be used.
    build:
      context: ..
      dockerfile: docker/Dockerfile.standalone
    env_file:
      - path: ../.env
        required: false
    environment:
      # Database configuration - loaded from .env file
      - NEO4J_URI=${NEO4J_URI}
      - NEO4J_USER=${NEO4J_USER}
      - NEO4J_PASSWORD=${NEO4J_PASSWORD}
      - NEO4J_DATABASE=${NEO4J_DATABASE:-neo4j}
      # Application configuration
      - GRAPHITI_GROUP_ID=${GRAPHITI_GROUP_ID:-main}
      - SEMAPHORE_LIMIT=${SEMAPHORE_LIMIT:-10}
      - CONFIG_PATH=/app/mcp/config/config.yaml
      - PATH=${PATH}
      # OpenAI Configuration
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - MODEL_NAME=${MODEL_NAME}
      - OPENAI_BASE_URL=${OPENAI_BASE_URL}
    volumes:
      - ../config/config-docker-neo4j.yaml:/app/mcp/config/config.yaml:ro
    ports:
      - "8000:8000" # Expose the MCP server via HTTP transport
    # Add host access to allow container to reach external Neo4j at 192.168.244.189
    extra_hosts:
      - "neo4j-host:192.168.244.189"
    networks:
      - graphiti-mcp-network
    command: ["uv", "run", "main.py"]
    restart: unless-stopped

networks:
  graphiti-mcp-network:
    driver: bridge
    # Allow containers to access external networks
